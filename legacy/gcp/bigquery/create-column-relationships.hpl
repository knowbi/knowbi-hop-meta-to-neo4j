<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<pipeline>
  <info>
    <name>tr_create_column_relationships</name>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <pipeline_status>0</pipeline_status>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>DB_DRIVER</name>
        <default_value>com.simba.googlebigquery.jdbc42.Driver</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>DB_PASSWORD</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>DB_TYPE</name>
        <default_value>bigquery</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>DB_URL</name>
        <default_value>jdbc:bigquery://https://www.googleapis.com/bigquery/v2:443;ProjectId=data-lake-dwh-sls;OAuthType=0;OAuthPvtKeyPath=/home/hans/projects/TVH/sls_mkt_prc.json;OAuthServiceAcctEmail=sls-mkt-prc-data-trans@data-lake-infrastructure-prod.iam.gserviceaccount.com;Timeout=120</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>DB_USERNAME</name>
        <default_value/>
        <description/>
      </parameter>
      <parameter>
        <name>DB_VERSION</name>
        <default_value>0</default_value>
        <description/>
      </parameter>
      <parameter>
        <name>PRM_QUERY</name>
        <default_value>SELECT query, destination_table.project_id, destination_table.dataset_id, destination_table.table_id, referenced_tables.project_id as ref_project_id, referenced_tables.dataset_id as ref_datset_id, referenced_tables.table_id as ref_table_id FROM `region-eu`.INFORMATION_SCHEMA.JOBS_BY_PROJECT, UNNEST(referenced_tables) referenced_tables WHERE DATE(creation_time)=CURRENT_DATE and destination_table.table_id not like 'anon%'</default_value>
        <description/>
      </parameter>
    </parameters>
    
    
    
    
    
    
    
    
    
    
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    
    
    
    
    <created_user>-</created_user>
    <created_date>2020/08/31 15:12:25.418</created_date>
    <modified_user>-</modified_user>
    <modified_date>2020/08/31 15:12:25.418</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  
  <order>
    <hop>
      <from>Replace in string</from>
      <to>Get Tables</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>Sort rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 2</from>
      <to>Sort rows 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows 2</from>
      <to>Merge join</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>Merge join</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Add version</from>
      <to>Select values 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 3</from>
      <to>If field value is null</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>If field value is null</from>
      <to>Neo4J Output</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get view definition</from>
      <to>Write to log</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get view definition</from>
      <to>Filter rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>Replace in string</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>Add version 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Add version 2</from>
      <to>Write uses</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Add version 2</from>
      <to>Write child_of</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Tables</from>
      <to>Replace in string 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Replace in string 2</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get Columns</from>
      <to>Replace in string 2 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Replace in string 2 2</from>
      <to>Select values 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Replace in string</from>
      <to>Filter rows 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows 2</from>
      <to>Sort rows 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Get view fields</from>
      <to>Sort rows 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows 4</from>
      <to>Merge join 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows 3</from>
      <to>Merge join 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge join 2</from>
      <to>Select values 2 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows 2</from>
      <to>Get Columns</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge join</from>
      <to>Merge join 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 2 2</from>
      <to>Merge join 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge join 3</from>
      <to>replace</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>replace</from>
      <to>Add version</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Add version</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>version</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>0</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1536</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Add version 2</name>
    <type>Constant</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>version</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>0</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>912</xloc>
      <yloc>64</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Filter rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to/>
    <send_false_to/>
    <compare>
      <condition>
        <negated>N</negated>
        <conditions>
          <condition>
            <negated>N</negated>
            <leftvalue>table_name</leftvalue>
            <function>&lt;&gt;</function>
            <rightvalue/>
            <value>
              <name>constant</name>
              <type>String</type>
              <text>sum_rolling_window_pre</text>
              <length>-1</length>
              <precision>-1</precision>
              <isnull>N</isnull>
              <mask/>
            </value>
          </condition>
          <condition>
            <negated>N</negated>
            <operator>OR</operator>
            <leftvalue>table_name</leftvalue>
            <function>&lt;&gt;</function>
            <rightvalue/>
            <value>
              <name>constant</name>
              <type>String</type>
              <text>quota_proposal_raw_rw_post</text>
              <length>-1</length>
              <precision>-1</precision>
              <isnull>N</isnull>
              <mask/>
            </value>
          </condition>
        </conditions>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>272</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Filter rows 2</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>Sort rows 3</send_true_to>
    <send_false_to>Get Columns</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <conditions>
          <condition>
            <negated>N</negated>
            <leftvalue>view_definition</leftvalue>
            <function>CONTAINS</function>
            <rightvalue/>
            <value>
              <name>constant</name>
              <type>String</type>
              <text>SELECT *</text>
              <length>-1</length>
              <precision>-1</precision>
              <isnull>N</isnull>
              <mask/>
            </value>
          </condition>
          <condition>
            <negated>N</negated>
            <operator>OR</operator>
            <leftvalue>view_definition</leftvalue>
            <function>CONTAINS</function>
            <rightvalue/>
            <value>
              <name>constant</name>
              <type>String</type>
              <text>select *</text>
              <length>-1</length>
              <precision>-1</precision>
              <isnull>N</isnull>
              <mask/>
            </value>
          </condition>
        </conditions>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>480</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Get Columns</name>
    <type>UserDefinedJavaClass</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <definitions>
      <definition>
        <class_type>TRANSFORM_CLASS</class_type>
        <class_name>Processor</class_name>
        <class_source>import bi.know.kettle.sqlparser.QueryParser;
import java.util.List; 

public boolean processRow(StepMetaInterface smi, StepDataInterface sdi) throws KettleException{

  Object[] row = getRow(); 

  if(row == null){
    setOutputDone(); 
    return false; 
  } 


  String query = get(Fields.In, "view_definition").getString(row);

  QueryParser parser = new QueryParser();
  parser.parseQuery(query);
  
  List&lt;String[]&gt; columnList = parser.getColumns();
  for(String[] columnArray : columnList){
      Object[] outputRow = createOutputRow(row, data.outputRowMeta.size()); 
      get(Fields.Out, "databasename").setValue(outputRow, columnArray[0]);
      get(Fields.Out, "schemaname").setValue(outputRow, columnArray[1]);
      get(Fields.Out, "tablename").setValue(outputRow, columnArray[2]);
      get(Fields.Out, "columnname").setValue(outputRow, columnArray[3]);
	  get(Fields.Out, "alias").setValue(outputRow, columnArray[4]);
      putRow(data.outputRowMeta, outputRow); 
    
  } 



  return true; 
}</class_source>
      </definition>
    </definitions>
    <fields>
      <field>
        <field_name>databasename</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>schemaname</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>tablename</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>columnname</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>alias</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
    </fields>
    <clear_result_fields>N</clear_result_fields>
    <info_steps/>
    <target_steps/>
    <usage_parameters/>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>640</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Get Tables</name>
    <type>UserDefinedJavaClass</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <definitions>
      <definition>
        <class_type>TRANSFORM_CLASS</class_type>
        <class_name>Processor</class_name>
        <class_source>import bi.know.kettle.sqlparser.QueryParser;
import java.util.List; 

public boolean processRow(StepMetaInterface smi, StepDataInterface sdi) throws KettleException{

  Object[] row = getRow(); 

  if(row == null){
    setOutputDone(); 
    return false; 
  } 


  String query = get(Fields.In, "view_definition").getString(row);

  QueryParser parser = new QueryParser();
  parser.parseQuery(query);
  
  List&lt;String[]&gt; tableList = parser.getTables();
  for(String[] tableArray : tableList){
      Object[] outputRow = createOutputRow(row, data.outputRowMeta.size()); 
      get(Fields.Out, "alias").setValue(outputRow, tableArray[0]);
      get(Fields.Out, "databasename").setValue(outputRow, tableArray[1]);
      get(Fields.Out, "schemaname").setValue(outputRow, tableArray[2]);
      get(Fields.Out, "tablename").setValue(outputRow, tableArray[3]);
      putRow(data.outputRowMeta, outputRow); 
    
  } 



  return true; 
}</class_source>
      </definition>
    </definitions>
    <fields>
      <field>
        <field_name>alias</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>databasename</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>schemaname</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
      <field>
        <field_name>tablename</field_name>
        <field_type>String</field_type>
        <field_length>-1</field_length>
        <field_precision>-1</field_precision>
      </field>
    </fields>
    <clear_result_fields>N</clear_result_fields>
    <info_steps/>
    <target_steps/>
    <usage_parameters/>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>640</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Get view definition</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>gennconn</connection>
    <sql>SELECT * EXCEPT(check_option) FROM `region-eu`.INFORMATION_SCHEMA.VIEWS
where UPPER(view_definition) not like '%UNNEST%'</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>64</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Get view fields</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>gennconn</connection>
    <sql>select 
	table_catalog
	,table_schema
	,table_name
	,column_name 
from `region-eu`.INFORMATION_SCHEMA.COLUMNS</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>768</xloc>
      <yloc>672</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>If field value is null</name>
    <type>IfNull</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <replaceAllByValue/>
    <replaceAllMask/>
    <selectFields>Y</selectFields>
    <selectValuesType>N</selectValuesType>
    <setEmptyStringAll>N</setEmptyStringAll>
    <valuetypes>
      </valuetypes>
    <fields>
      <field>
        <name>view_project</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>view_dataset</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>view_table</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>view_column</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>table_dataset</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>table_project</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>table_name</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>table_column</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>version</name>
        <value>Unknown</value>
        <mask/>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1824</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Merge join</name>
    <type>MergeJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>LEFT OUTER</join_type>
    <step1>Sort rows</step1>
    <step2>Sort rows 2</step2>
    <keys_1>
      <key>origin_project_name</key>
      <key>origin_dataset_name</key>
      <key>origin_table_name</key>
      <key>table_alias</key>
    </keys_1>
    <keys_2>
      <key>origin_project_name</key>
      <key>origin_dataset_name</key>
      <key>origin_table_name</key>
      <key>tablename</key>
    </keys_2>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1184</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Merge join 2</name>
    <type>MergeJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>INNER</join_type>
    <step1>Sort rows 3</step1>
    <step2>Sort rows 4</step2>
    <keys_1>
      <key>table_catalog</key>
      <key>table_schema</key>
      <key>table_name</key>
    </keys_1>
    <keys_2>
      <key>table_catalog</key>
      <key>table_schema</key>
      <key>table_name</key>
    </keys_2>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>768</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Merge join 3</name>
    <type>MergeJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <join_type>LEFT OUTER</join_type>
    <step1>Merge join</step1>
    <step2>Select values 2 2</step2>
    <keys_1>
      <key>origin_project_name</key>
      <key>origin_dataset_name</key>
      <key>origin_table_name</key>
    </keys_1>
    <keys_2>
      <key>alternative_project_name</key>
      <key>alternative_dataset_name</key>
      <key>alternative_table_name</key>
    </keys_2>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1296</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Neo4J Output</name>
    <type>Neo4JOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>lineage-graph</connection>
    <batch_size>1000</batch_size>
    <key/>
    <create_indexes>N</create_indexes>
    <use_create>N</use_create>
    <only_create_relationships>N</only_create_relationships>
    <returning_graph>N</returning_graph>
    <return_graph_field>graph</return_graph_field>
    <from>
      <read_only_from_node>N</read_only_from_node>
      <labels>
        <label/>
        <value>Column</value>
      </labels>
      <properties>
        <property>
          <name>column</name>
          <value>view_column</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>table</name>
          <value>view_table</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>schema</name>
          <value>view_dataset</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>database</name>
          <value>view_project</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>version</name>
          <value>version</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
      </properties>
    </from>
    <to>
      <read_only_to_node>N</read_only_to_node>
      <labels>
        <label/>
        <value>Column</value>
      </labels>
      <properties>
        <property>
          <name>column</name>
          <value>table_column</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>table</name>
          <value>table_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>schema</name>
          <value>table_dataset</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>database</name>
          <value>view_project</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>version</name>
          <value>version</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
      </properties>
    </to>
    <relationship/>
    <relationship_value>DEPENDS_ON</relationship_value>
    <relprops/>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1952</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Replace in string</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>no</use_regex>
        <replace_string>`</replace_string>
        <replace_by_string/>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>(.*)(-{2}.*)</replace_string>
        <replace_by_string>$1</replace_by_string>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>.*#.*</replace_string>
        <replace_by_string/>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>([a-z]*)-([a-z]*)</replace_string>
        <replace_by_string>$1_$2</replace_by_string>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>.*REGEXP_CONTAINS.*,\n</replace_string>
        <replace_by_string/>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>.*REGEXP_CONTAINS.*</replace_string>
        <replace_by_string>null</replace_by_string>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
      <field>
        <in_stream_name>view_definition</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>\u00a0</replace_string>
        <replace_by_string> </replace_by_string>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>480</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Replace in string 2</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <in_stream_name>databasename</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>([a-z]*)_([a-z]*)</replace_string>
        <replace_by_string>$1-$2</replace_by_string>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>768</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Replace in string 2 2</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <in_stream_name>databasename</in_stream_name>
        <out_stream_name/>
        <use_regex>yes</use_regex>
        <replace_string>([a-z]*)_([a-z]*)</replace_string>
        <replace_by_string>$1-$2</replace_by_string>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>768</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>table_catalog</name>
        <rename>origin_project_name</rename>
      </field>
      <field>
        <name>table_schema</name>
        <rename>origin_dataset_name</rename>
      </field>
      <field>
        <name>table_name</name>
        <rename>origin_table_name</rename>
      </field>
      <field>
        <name>schemaname</name>
        <rename>dataset_name</rename>
      </field>
      <field>
        <name>databasename</name>
        <rename>project_name</rename>
      </field>
      <field>
        <name>alias</name>
        <rename>table_alias</rename>
      </field>
      <field>
        <name>tablename</name>
        <rename>table_name</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>912</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Select values 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>table_catalog</name>
        <rename>origin_project_name</rename>
      </field>
      <field>
        <name>table_schema</name>
        <rename>origin_dataset_name</rename>
      </field>
      <field>
        <name>table_name</name>
        <rename>origin_table_name</rename>
      </field>
      <field>
        <name>databasename</name>
      </field>
      <field>
        <name>schemaname</name>
      </field>
      <field>
        <name>tablename</name>
      </field>
      <field>
        <name>columnname</name>
      </field>
      <field>
        <name>alias</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>912</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Select values 2 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>table_catalog</name>
        <rename>alternative_project_name</rename>
      </field>
      <field>
        <name>table_schema</name>
        <rename>alternative_dataset_name</rename>
      </field>
      <field>
        <name>table_name</name>
        <rename>alternative_table_name</rename>
      </field>
      <field>
        <name>column_name</name>
        <rename>alternative_column_name</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1296</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Select values 3</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>origin_project_name</name>
        <rename>view_project</rename>
      </field>
      <field>
        <name>origin_dataset_name</name>
        <rename>view_dataset</rename>
      </field>
      <field>
        <name>origin_table_name</name>
        <rename>view_table</rename>
      </field>
      <field>
        <name>alias</name>
        <rename>view_column</rename>
      </field>
      <field>
        <name>dataset_name</name>
        <rename>table_dataset</rename>
      </field>
      <field>
        <name>project_name</name>
        <rename>table_project</rename>
      </field>
      <field>
        <name>table_name</name>
      </field>
      <field>
        <name>columnname</name>
        <rename>table_column</rename>
      </field>
      <field>
        <name>version</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1680</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>origin_project_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>origin_dataset_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>origin_table_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>table_alias</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1056</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Sort rows 2</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>origin_project_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>origin_dataset_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>origin_table_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>tablename</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1184</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Sort rows 3</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>table_catalog</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>table_schema</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>table_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>640</xloc>
      <yloc>480</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Sort rows 4</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>table_catalog</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>table_schema</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>table_name</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>768</xloc>
      <yloc>560</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Write child_of</name>
    <type>Neo4JOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>lineage-graph</connection>
    <batch_size>1000</batch_size>
    <key/>
    <create_indexes>N</create_indexes>
    <use_create>N</use_create>
    <only_create_relationships>Y</only_create_relationships>
    <returning_graph>N</returning_graph>
    <return_graph_field>graph</return_graph_field>
    <from>
      <read_only_from_node>N</read_only_from_node>
      <labels>
        <label/>
        <value>Table</value>
      </labels>
      <properties>
        <property>
          <name>table</name>
          <value>table_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>schema</name>
          <value>dataset_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>database</name>
          <value>project_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>version</name>
          <value>version</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
      </properties>
    </from>
    <to>
      <read_only_to_node>N</read_only_to_node>
      <labels>
        <label/>
        <value>View</value>
      </labels>
      <properties>
        <property>
          <name>table</name>
          <value>origin_table_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>schema</name>
          <value>origin_dataset_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>database</name>
          <value>origin_project_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>version</name>
          <value>version</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
      </properties>
    </to>
    <relationship/>
    <relationship_value>CHILD_OF</relationship_value>
    <relprops/>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1184</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Write to log</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <loglevel>log_level_basic</loglevel>
    <displayHeader>Y</displayHeader>
    <limitRows>N</limitRows>
    <limitRowsNumber>0</limitRowsNumber>
    <logmessage/>
    <fields>
      <field>
        <name>table_catalog</name>
      </field>
      <field>
        <name>table_schema</name>
      </field>
      <field>
        <name>table_name</name>
      </field>
      <field>
        <name>use_standard_sql</name>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>64</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>Write uses</name>
    <type>Neo4JOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>lineage-graph</connection>
    <batch_size>1000</batch_size>
    <key/>
    <create_indexes>N</create_indexes>
    <use_create>N</use_create>
    <only_create_relationships>Y</only_create_relationships>
    <returning_graph>N</returning_graph>
    <return_graph_field>graph</return_graph_field>
    <from>
      <read_only_from_node>N</read_only_from_node>
      <labels>
        <label/>
        <value>View</value>
      </labels>
      <properties>
        <property>
          <name>table</name>
          <value>origin_table_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>schema</name>
          <value>origin_dataset_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>database</name>
          <value>origin_project_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>version</name>
          <value>version</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
      </properties>
    </from>
    <to>
      <read_only_to_node>N</read_only_to_node>
      <labels>
        <label/>
        <value>Table</value>
      </labels>
      <properties>
        <property>
          <name>table</name>
          <value>table_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>schema</name>
          <value>dataset_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>database</name>
          <value>project_name</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
        <property>
          <name>version</name>
          <value>version</value>
          <type>String</type>
          <primary>Y</primary>
        </property>
      </properties>
    </to>
    <relationship/>
    <relationship_value>USES</relationship_value>
    <relprops/>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1184</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform>
    <name>replace</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>//Script here

if(alias == null){
var alias=alternative_column_name;
var columnname=alternative_column_name;
}
</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>alias</name>
        <rename>alias</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
      <field>
        <name>columnname</name>
        <rename>columnname</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>Y</replace>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    
    <GUI>
      <xloc>1408</xloc>
      <yloc>192</yloc>
      <draw>Y</draw>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  
  
  <attributes/>
</pipeline>
